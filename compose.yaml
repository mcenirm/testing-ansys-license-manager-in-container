services:
  test:
    build:
      context: test-image
    volumes:
      - ansys_inc:/ansys_inc
      - usr_ansys_inc:/usr/ansys_inc
      - ./AnsysLicenseManager/:/AnsysLicenseManager/:ro,Z
    working_dir: /AnsysLicenseManager/linx64
    command: |
      bash -c '
        ./INSTALL -silent -LM
        head -v -n20 /ansys_inc/*.err /usr/ansys_inc/*.err
        tail -v -n10 /ansys_inc/*.log /usr/ansys_inc/*.log
        (cd /ansys_inc/v232/licensingclient/linx64 && ./lmutil lmver lmutil)
      '

volumes:
  ansys_inc:
  usr_ansys_inc:
